---
title: "DDI report experimental and results sections for one DDI simulation"
author: SimcypConsultancy package version `r packageVersion("SimcypConsultancy")`
date: "Compiled on `r format(Sys.time(), '%B %d, %Y')`"
output: word_document
---

```{r setupResultsSection, echo=FALSE}

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, 
                      dpi = 600, 
                      fig.width = 6, 
                      fig.height = 5)

```

```{r SetupVars2}

MyEffector <- determine_myeffector(Deets = Deets, 
                                   prettify_compound_names = prettify_compound_names)
MySubstrate <- ifelse(prettify_compound_names, 
                      prettify_compound_name(Deets$Substrate), Deets$Substrate)

SingMult_sub <- ifelse(Deets$Regimen_sub %in% c("custom dosing",
                                                "Multiple Dose"),
                       "multiple", "single")
SingMult_inhib <- ifelse(Deets$Regimen_inhib %in% c("custom dosing",
                                                    "Multiple Dose"),
                         "multiple", "single")

SDMD_sub_txt <- paste(ifelse(SingMult_sub == "single", "a single", "multiple"),
                      
                      switch(Deets$DoseRoute_sub,
                             "custom dosing" = "CUSTOM DOSING - FILL IN MANUALLY",
                             "Oral" = "oral",
                             "IV" = "IV"),
                      
                      ifelse(SingMult_sub == "single", "dose", "doses")
)

DoseFreq_sub <- switch(as.character(Deets$DoseInt_sub),
                       "12" = "BID",
                       "24" = "QD",
                       "8" = "three times per day",
                       "6" = "four times per day",
                       "48" = "every other day",
                       "NA" = "single dose")
DoseFreq_sub <- ifelse(is.null(DoseFreq_sub),
                       # paste("Q", DoseFreq_sub, "H"),
                       "CUSTOM DOSING - FILL IN MANUALLY",
                       DoseFreq_sub)

SDMD_inhib_txt <- paste(ifelse(SingMult_inhib == "single", "a single", "multiple"),
                        
                        switch(Deets$DoseRoute_inhib,
                               "custom dosing" = "CUSTOM DOSING - FILL IN MANUALLY",
                               "Oral" = "oral",
                               "IV" = "IV"),
                        
                        ifelse(SingMult_inhib == "single", "dose", "doses")
)

DoseFreq_inhib <- switch(as.character(Deets$DoseInt_inhib),
                         "12" = "BID",
                         "24" = "QD",
                         "8" = "three times per day",
                         "6" = "four times per day",
                         "48" = "every other day",
                         "NA" = "single dose")
DoseFreq_inhib <- ifelse(is.null(DoseFreq_inhib),
                         # paste("Q", DoseFreq_inhib, "H"),
                         "CUSTOM DOSING - FILL IN MANUALLY",
                         DoseFreq_inhib)

NumDaysInhib <- suppressWarnings(
   Deets$NumDoses_inhib*as.numeric(Deets$DoseInt_inhib)/24)
NumDaysInhib <- ifelse(is.na(NumDaysInhib), "CUSTOM DOSING - FILL IN MANUALLY",
                       NumDaysInhib)

numbers <- c("one", "two", "three", "four", "five", "six", "seven", "eight",
             "nine", "ten", "eleven", "twelve", "thirteen", "fourteen",
             "fifteen", "sixteen", "seventeen", "eighteen", "nineteen", "twenty")

Numbers <- str_to_title(numbers)

DoseDay <- str_split_fixed(Deets$StartDayTime_sub, "Day |, ", 3)[2]
LastDig <- as.numeric(str_sub(DoseDay, start = -1, end = -1))
DoseDay <- paste0(DoseDay, ifelse(LastDig %in% c(0, 4:9),
                                  "th",
                                  ifelse(LastDig == 1, "st",
                                         ifelse(LastDig == 2, "nd", "rd"))))

DefaultCompound_txt <- ifelse(default_cmpd_file, 
                              paste("The default compound library file for",
                                    ifelse(victim_sim, MyEffector, MySubstrate),
                                    "was used."), "")

```

# METHODS

#### Simulation of `r sub("^A", "a", str_to_title(SDMD_sub_txt))` of `r Deets$Dose_sub` mg `r paste(ifelse(prettify_compounds_names, str_to_title(MySubstrate), MySubstrate), ifelse(SingMult_sub == "multiple", DoseFreq_sub, ""))` Administered with `r str_to_title(MyEffector)` in `r tidyPop(Deets$Population)$PopulationCap` 

`r ifelse(Deets$NumTrials %in% 1:20, Numbers[Deets$NumTrials], Deets$NumTrials)` virtual trials of `r Deets$NumSubjTrial` `r tidyPop(Deets$Population)$Population` (`r Deets$PercFemale*100`% female) aged `r Deets$Age_min` to `r Deets$Age_max` years receiving `r SDMD_sub_txt` of `r Deets$Dose_sub` mg `r MySubstrate` in the absence of `r MyEffector` and `r ifelse(SingMult_sub == "multiple", "with", paste("on the", DoseDay, "day of"))` `r NumDaysInhib` days of dosing of `r MyEffector` (`r Deets$Dose_inhib` mg `r DoseFreq_inhib`) were generated. `r DefaultCompound_txt` Performance verification of the `r ifelse(victim_sim, MyEffector, MySubstrate)` model is provided in Appendix A â€“ Performance Verification of CYP3A Substrates, Inhibitors and Inducers.



# RESULTS

### Simulation of `r sub("^A", "a", str_to_title(SDMD_sub_txt))` of `r Deets$Dose_sub` mg `r paste(ifelse(prettify_compounds_names, str_to_title(MySubstrate), MySubstrate), ifelse(SingMult_sub == "multiple", DoseFreq_sub, ""))` Administered with `r str_to_title(MyEffector)` in `r tidyPop(Deets$Population)$PopulationCap` 

Mean simulated plasma `r MySubstrate` concentrations following `r SDMD_sub_txt` of `r Deets$Dose_sub` mg `r MySubstrate` in the absence of `r MyEffector` and `r ifelse(SingMult_sub == "mMultiple", "with", paste("on the", DoseDay, "day of"))` `r NumDaysInhib` days of dosing of `r MyEffector` (`r Deets$Dose_inhib` mg `r DoseFreq_inhib`) are illustrated in Figure XXX. Simulated plasma concentrations of `r MyEffector` are depicted in Figure XXX. `r ifelse(include_enz_plot, paste0("Simulated hepatic ", enzyme, " levels in the absence and during administration of ", MyEffector, " are indicated in Figure XXX. "), "")`The simulated geometric mean `r ifelse(SingMult_sub == "single", "AUC~inf~", "AUC~tau~")` and C~max~ values and corresponding GMRs for `r MySubstrate` in the absence and presence of `r MyEffector` are listed in Table XXX.


```{r pullPK}

PKsum <- pksummary_table(sim_data_file = paste0(OutPath, "/", sim_data_file), 
                         PKparameters = PKparameters, 
                         observed_PK = observed_PK,
                         mean_type = mean_type_PK, 
                         concatVariability = concatVariability,
                         tissue = tissue, 
                         includeCV = includeCV,
                         includeConfInt = includeConfInt,
                         includeTrialMeans = includeTrialMeans,
                         include_dose_num = TRUE, # will adjust later
                         prettify_compound_names = prettify_compound_names, 
                         adjust_conc_units = "ng/mL") 

pretfun <- function(X){
   if(prettify_compound_names){
      X <- sub(as.character(prettify_compound_names["effector"]),
               "effector", X)
   } else {
      X <- sub(MyEffector, "effector", X)
   }
   return(X)
}

ugfun <- function(X){
   if(prettify_compound_names){
      X <- sub("effector", as.character(prettify_compound_names["effector"]),
               X)
   } else {
      X <- sub("effector", MyEffector, X)
   }
   return(X)
}

PKToPull_DF <- data.frame(
   PrettifiedNames = sapply(names(PKsum$Table), pretfun)) %>%
   left_join(AllPKParameters %>% select(PKparameter, PrettifiedNames),
             multiple = "all", by = "PrettifiedNames") %>%
   filter(complete.cases(PKparameter) &
             !str_detect(PKparameter, "PercExtrap")) %>% 
   unique()

Dose1included <- any(str_detect(PKToPull_DF$PKparameter, "_dose1"))
LastDoseincluded <- any(str_detect(PKToPull_DF$PKparameter, "_last"))
Observedincluded <- any(complete.cases(observed_PK))

FigText2 <- ifelse(Dose1included & LastDoseincluded, 
                   ifelse(Deets$DoseRoute_sub == "Oral", 
                          "the first and multiple oral doses", 
                          paste("the first and multiple", 
                                Deets$DoseRoute_sub, "doses")),
                   ifelse(Dose1included, 
                          ifelse(Deets$DoseRoute_sub == "Oral", 
                                 "the first oral dose",
                                 paste("the first", Deets$DoseRoute_sub, "dose")),
                          ifelse(Deets$DoseRoute_sub == "Oral", 
                                 "multiple oral doses", 
                                 paste("multiple", Deets$DoseRoute_sub, "doses"))))

FigText3 <- ifelse(any(complete.cases(MyEffector)),
                   paste0("with or without ", MyEffector, " "),
                   "")

MeanTypePK <- ifelse(is.na(mean_type_PK), "geometric", mean_type_PK)

MyPKResults <- PKsum$Table

# If not all the pk parameters were able to be pulled, then we get trouble when
# formatting the table in the next chunk. Adding columns with blank values if
# they're not there.
PKWeShouldHave <- switch(SingMult_sub, 
                         "multiple" = c("AUCtau_last",
                                        "Cmax_last", 
                                        "AUCtau_last_withInhib",
                                        "Cmax_last_withInhib", 
                                        "AUCtau_ratio_last",
                                        "Cmax_ratio_last"),
                         "single" = switch(as.character(any(str_detect(PKToPull_DF$PKparameter, "AUCt_dose1"))), 
                                           "TRUE" = c("AUCinf_dose1",
                                                      "AUCt_dose1",
                                                      "Cmax_dose1", 
                                                      "AUCinf_dose1_withInhib",
                                                      "AUCt_dose1_withInhib",
                                                      "Cmax_dose1_withInhib", 
                                                      "AUCinf_ratio_dose1",
                                                      "AUCt_ratio_dose1",
                                                      "Cmax_ratio_dose1"),
                                           "FALSE" = c("AUCinf_dose1",
                                                       "Cmax_dose1", 
                                                       "AUCinf_dose1_withInhib",
                                                       "Cmax_dose1_withInhib", 
                                                       "AUCinf_ratio_dose1",
                                                       "Cmax_ratio_dose1")))
MissingPK <- setdiff(PKWeShouldHave, PKToPull_DF$PKparameter)

if(length(MissingPK) > 0){
   ToAdd <- as.data.frame(matrix(NA, nrow = nrow(MyPKResults), ncol = length(MissingPK)))
   names(ToAdd) <- MissingPK
   
   MyPKResults <- bind_cols(MyPKResults, ToAdd)
}

# Getting the right order of columns
TempNames <- PKToPull_DF %>% 
   bind_rows(data.frame(PrettifiedNames = "Statistic", 
                        PKparameter = "Statistic")) %>% 
   mutate(PKparameter = factor(PKparameter, levels = c("Statistic", 
                                                       PKWeShouldHave))) %>% 
   arrange(PKparameter)

MyPKResults <- MyPKResults[, ugfun(TempNames$PrettifiedNames)]

if(is.na(include_dose_num)){
   # Dropping dose number depending on input. First, checking whether they have
   # both dose 1 and last-dose data.
   DoseCheck <- c("first" = any(str_detect(names(MyPKResults), "Dose 1")), 
                  "last" = any(str_detect(names(MyPKResults), "Last dose")))
   include_dose_num <- all(DoseCheck)
}

# include_dose_num now should be either T or F no matter what, so checking
# that.
if(is.logical(include_dose_num) == FALSE){
   warning("Something is amiss with your input for `include_dose_num`, which should be NA, TRUE, or FALSE. We'll assume you meant for it to be TRUE.", 
           call. = FALSE)
   include_dose_num <- TRUE
}

if(include_dose_num == FALSE){
   names(MyPKResults) <- sub("Dose 1 |Last dose ", "", names(MyPKResults))
}


```


*Table XXX. Simulated`r ifelse(Observedincluded, " and observed", "")` `r MeanTypePK` mean `r tissue` PK parameters for `r MySubstrate` after `r FigText2` of `r paste(Deets$Dose_sub, "mg", MySubstrate)` `r FigText3`in `r tidyPop(Deets$Population)$Population`.*

```{r makeTablePKSummaryOutput, fig.width = 7}

TableSubHead <- as.data.frame(t(names(MyPKResults)))
names(MyPKResults) <- paste0("V", 1:ncol(MyPKResults))

FT <- flextable::flextable(
   MyPKResults %>% mutate(V1 = ifelse(V1 == "Simulated", 
                                      paste(str_to_title(MeanTypePK), "mean"),
                                      V1))) %>%
   
   # making the width work
   flextable::set_table_properties(layout = "fixed") %>%
   flextable::width(width = 1) %>%
   
   flextable::delete_part(part = "header")

if(ncol(MyPKResults) == 7){
   
   FT <- FT %>%
      flextable::add_header(
         # Statistic
         V1 = "",
         
         # AUCinf_dose1 or AUCtau_last
         V2 = ifelse(is.logical(prettify_compound_names) && 
                        prettify_compound_names == TRUE,
                     str_to_title(MySubstrate), MySubstrate),
         
         # Cmax
         V3 = ifelse(is.logical(prettify_compound_names) && 
                        prettify_compound_names == TRUE,
                     str_to_title(MySubstrate), MySubstrate),
         
         # AUC with effector
         V4 = paste(ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MySubstrate), MySubstrate), "plus", 
                    ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MyEffector), MyEffector)),
         
         # Cmax with effector
         V5 = paste(ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MySubstrate), MySubstrate), "plus", 
                    ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MyEffector), MyEffector)),
         
         # GMRs
         V6 = "GMR",
         V7 = "GMR") 
   
} else if(ncol(MyPKResults) == 10){
   FT <- FT %>% 
      flextable::add_header(
         # Statistic
         V1 = "",
         
         # AUCinf_dose1
         V2 = ifelse(is.logical(prettify_compound_names) && 
                        prettify_compound_names == TRUE,
                     str_to_title(MySubstrate), MySubstrate),
         
         # AUCt_dose1
         V3 = ifelse(is.logical(prettify_compound_names) && 
                        prettify_compound_names == TRUE,
                     str_to_title(MySubstrate), MySubstrate),
         
         # Cmax_dose1
         V4 = ifelse(is.logical(prettify_compound_names) && 
                        prettify_compound_names == TRUE,
                     str_to_title(MySubstrate), MySubstrate),
         
         # AUCinf_dose1_withInhib
         V5 = paste(ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MySubstrate), MySubstrate), "plus", 
                    ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MyEffector), MyEffector)),
         
         # AUCt_dose1_withInhib
         V6 = paste(ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MySubstrate), MySubstrate), "plus", 
                    ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MyEffector), MyEffector)),
         
         # Cmax_dose1_withInhib
         V7 = paste(ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MySubstrate), MySubstrate), "plus", 
                    ifelse(is.logical(prettify_compound_names) && 
                              prettify_compound_names == TRUE,
                           str_to_title(MyEffector), MyEffector)),
         
         # GMRs
         V8 = "GMR",
         V9 = "GMR", 
         V10 = "GMR") 
   
}

FT <- FT %>%
   flextable::merge_h(part = "header") %>%
   flextable::add_body(values = TableSubHead) %>%
   
   # center text
   flextable::align(align = "center", part = "all") %>%
   
   # Set the font size
   flextable::fontsize(part = "body", size = fontsize) %>%
   
   # Make the text bold
   flextable::bold(part = "body", i = 1) %>%
   flextable::bold(part = "body", j = 1) %>%
   flextable::bold(part = "header") %>%
   
   # borders
   flextable::border_remove() %>%
   flextable::vline(border = officer::fp_border(width = 0.5), part = "all") %>%
   flextable::hline_bottom(border = officer::fp_border(width = 0.5)) %>%
   flextable::hline_top(border = officer::fp_border(width = 0.5), part = "header") %>%
   flextable::hline_top(border = officer::fp_border(width = 0.5), part = "body",
                        j = 2:ncol(MyPKResults)) %>%
   flextable::vline_left(part = "all", border = officer::fp_border(width = 0.5)) %>%
   flextable::hline(border = officer::fp_border(width = 0.5),
                    part = "body", i = 1)

# Dealing with subscripts
NamePattern <- " AUCt | AUCinf | AUCtau | Cmax | Cmin | tmax | fa| fg| fh| ka| tlag"

ColNames <- data.frame(OrigName = as.character(TableSubHead)) %>% 
   mutate(Part1 = sapply(OrigName, 
                         FUN = function(x) {str_split(x, pattern = NamePattern)[[1]][1]}), 
          Part2 = sub("inf|tau|max|min|a|g|h|lag", "", str_trim(str_extract(OrigName, NamePattern))), 
          Part2 = sub("AUCt", "AUC", Part2),
          Subscript = sub(" AUC| C| t| f| k", "", str_extract(OrigName, NamePattern)), 
          Part3 = sapply(OrigName, 
                         FUN = function(x) {str_split(x, pattern = NamePattern)[[1]][2]})) 

for(i in 1:nrow(ColNames)){
   
   if(complete.cases(ColNames$Subscript[i])){
      FT <- FT %>% 
         flextable::compose(part = "body", i = 1,
                            j = which(TableSubHead == ColNames$OrigName[i]),
                            value = flextable::as_paragraph(ColNames$Part1[i], " ",
                                                            ColNames$Part2[i],
                                                            flextable::as_sub(ColNames$Subscript[i]), 
                                                            ColNames$Part3[i]))
   }
}

FT

names(MyPKResults) <- as.character(TableSubHead)

```

```{r captionPKSummary}

CapText1 <- ifelse(any(str_detect(names(MyPKResults), "tmax")), 
                   paste("the", MeanTypePK, "means, except for t~max~, which is median, minimum, and maximum"),
                   paste("the", MeanTypePK, "means"))

CapText2a <- paste0(ifelse(any(str_detect(MyPKResults$Statistic, "CV")),
                           "CV: coefficient of variation; ", ""), 
                    ifelse(any(str_detect(MyPKResults$Statistic, " CI")),
                           "CI: confidence interval; ", ""))

# Cleaning up clin_study_name so that "Clinical Study" isn't repeated regardless
# of whether they had included that in the name.
clin_study_name <- sub("Clinical Study|clinical study|clin study", "", 
                       clin_study_name)

CapText2 <- paste0(sub("; $", ".", CapText2a), 
                   ifelse(Observedincluded, 
                          paste0("S/O: simulated/observed; source observed data: Clinical Study ",
                                 clin_study_name, "; "),
                          ""))

```

*Simulated values listed are `r CapText1`. `r CapText2` Source simulated data: `r basename(sim_data_file)`* 

`r ifelse(exists("PKWeShouldHave", inherits = FALSE), "WARNING: There were problems extracting some PK values, e.g., problems with extrapolation to infinity. Please check your results.", "")`


```{r ctplotheading}

InhibPresent <- TRUE

Text2 <- ifelse(InhibPresent, 
                paste0("co-administered with ", MyEffector, " "), "")

Text1 <- "Linear (A) and log-linear (B)"
# Text1 <- switch(linear_or_log, 
#                 "both" = "Linear (A) and log-linear (B)",
#                 "both horizontal" ="Linear (A) and log-linear (B)",
#                 "both vertical" = "Linear (A) and log-linear (B)",
#                 "linear" = "Linear", 
#                 "log" = "Log-linear",
#                 "semi-log" = "Log-linear", 
#                 "horizontal and vertical" = "Linear (A) and log-linear (B)")

```

*Figure XXX. `r Text1` simulated `r tissue` concentration-time profiles of `r MySubstrate` `r Text2`in `r tidyPop(Deets$Population)$Population`.*

```{r ctplot, fig.width = 5, fig.height = 6}

ct_plot(ct_dataframe %>% filter(File == sim_data_file & Tissue == tissue,
                                CompoundID == "substrate"), 
        figure_type = figure_type_sub, 
        time_range = time_range_sub,
        y_axis_label = y_axis_label_sub,
        x_axis_interval = x_axis_interval_sub, 
        y_axis_limits_log = y_axis_limits_log_sub, 
        legend_position = "none", 
        legend_label = legend_label_sub,
        prettify_compound_names = c("substrate" = MySubstrate, 
                                    "inhibitor" = MyEffector),
        linear_or_log = linear_or_log_sub)

```

```{r ctplotCaption}

CapText1 <- paste(
   ifelse(nrow(ct_dataframe %>% filter(Simulated == FALSE)) > 0,
          paste0("and observed (circles; ", mean_type_graph, 
                 " mean of n = ", Deets$NumTrials * Deets$NumSubjTrial,
                 " individuals; Clinical Study ", clin_study_name), 
          ""), 
   tissue, "concentration-time profiles of", MySubstrate, 
   "in the absence of", MyEffector, "(solid line)",
   ifelse(SingMult_sub == "multiple", "and with",
          paste("and on the", DoseDay, "day of")),
   NumDaysInhib,"days of dosing of", 
   MyEffector, "(dashed line)")

figure_type <- "means only"
CapText2 <- switch(
   figure_type, 
   "trial means" = 
      paste("The grey lines represent",
            mean_type_graph, 
            "mean values of simulated individual trials and the black lines portray the",
            mean_type_graph, 
            "mean data"), 
   "percentiles" = 
      paste("The lighter lines represent the 5th and 95th percentiles and the darker lines the",
            mean_type_graph, 
            "mean data"), 
   "percentile ribbon" = 
      paste("The shaded regions represent the 5th to the 95th percentiles and the lines the",
            mean_type_graph, "mean data"), 
   "means only" = 
      paste("The lines represent the", 
            mean_type_graph, "mean data"), 
   "Freddy" = 
      paste("The grey lines represent", 
            mean_type_graph, 
            "mean values of simulated individual trials and the black lines portray the",
            mean_type_graph, 
            "mean data"))

NextChunkHeight <- ifelse(figure_type_inhib %in% c("both", "both vertical"), 6, 3)

```

*Depicted are `r CapText1`. `r CapText2` of the simulated population (n = `r Deets$NumTrials * Deets$NumSubjTrial`)`r ifelse(figure_type == "Freddy", ". The dashed lines represent the 5th and 95th percentiles", "")`. Source simulated data: `r sim_data_file`.*



*Figure XXX. Simulated `r tissue` concentration-time profiles of `r paste(Deets$Dose_inhib, "mg", DoseFreq_inhib, MyEffector)` in `r tidyPop(Deets$Population)$Population`.*


```{r ctplotInhib, fig.width=5, fig.height=NextChunkHeight}

ct_plot(ct_dataframe %>% filter(File == sim_data_file & Tissue == tissue,
                                CompoundID == "inhibitor 1"), 
        figure_type = figure_type_inhib, 
        time_range = time_range_inhib,
        y_axis_label = y_axis_label_inhib,
        x_axis_interval = x_axis_interval_inhib, 
        y_axis_limits_log = y_axis_limits_log_inhib, 
        legend_position = "bottom", 
        prettify_compound_names = c("substrate" = MySubstrate, 
                                    "inhibitor" = MyEffector),
        linear_or_log = linear_or_log_inhib)

CapText3 <- switch(
   figure_type_inhib, 
   "trial means" = 
      paste("The grey lines represent",
            mean_type_graph, 
            "mean values of simulated individual trials and the black lines portray the",
            mean_type_graph, 
            "mean data"), 
   "percentiles" = 
      paste("The lighter lines represent the 5th and 95th percentiles and the darker lines the",
            mean_type_graph, 
            "mean data"), 
   "percentile ribbon" = 
      paste("The shaded regions represent the 5th to the 95th percentiles and the lines the",
            mean_type_graph, "mean data"), 
   "means only" = 
      paste("The lines represent the", 
            mean_type_graph, "mean data"), 
   "Freddy" = 
      paste("The grey lines represent", 
            mean_type_graph, 
            "mean values of simulated individual trials and the black lines portray the",
            mean_type_graph, 
            "mean data"))


```

*Depicted are simulated `r tissue` concentration-time profiles of `r MyEffector` with administration of `r MySubstrate` on the `r DoseDay` day of `r NumDaysInhib` days of dosing. `r CapText3` for the simulated population (n = `r Deets$NumTrials * Deets$NumSubjTrial`). Source simulated data: `r sim_data_file`.*


```{r OptionalEnz, echo = FALSE, results = "asis"}

if(include_enz_plot){
   OptionalSection <- knitr::knit_child(
      system.file("rmarkdown/templates/enzabund/skeleton/skeleton.Rmd",
                  package="SimcypConsultancy"), 
      envir = environment(), 
      quiet = TRUE)
   
   cat(OptionalSection, sep = "\n")
}

```

