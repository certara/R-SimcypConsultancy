---
title: "Concentration-time plots"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{conc-time-plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
    echo = FALSE,
    collapse = TRUE,
    comment = "#>"
)
```

```{r setup, echo = FALSE, message=FALSE}
library(tidyverse)
library(SimcypConsultancy)
```

# An overview of making concentration-time or enzyme-abundance plots with the SimcypConsultancy package 

The general work flow for making graphs with the SimcypConsultancy package is to 1) extract your data from Simcyp Simulator output Excel files and then 2) make your graph(s). Extracting data requires one of the following functions: 

1. extractConcTime
2. extractConcTime_mult
3. extractEnzAbund

Since vignettes stored with packages don't contain Excel data, we'll skip step 1 in the workflow and go straight to the graphing. Please see the help files for the data extraction functions for explanations on how to use them, though. 

# Basic concentration-time plots of a single compound in a single tissue 

The function "ct_plot" will allow you to automatically graph almost any concentration-time data present in Simulator output Excel files. (It doesn't yet work with the "mechanistic" models such as M-ADAM.) While this function has many options, the default settings will generally create decent graphs that comply with Consultancy Team report templates. 

## ct_plot example 1: Substrate data showing simulated percentiles  

Let's make a graph of substrate concentration-time data in plasma, including some observed data. (To get these data normally, you would run the function "extractConcTime" to extract the data.) We'll use letermovir dummy data, which available as part of the package by calling on the object "LMVct". 

```{r}
ct_plot(ct_dataframe = LMVct)
```

## ct_plot example 2: Zoom in on the last dose 

Let's zoom in on the last dose only. 


```{r, echo=TRUE}
ct_plot(ct_dataframe = LMVct, time_range = "last dose")
```


## ct_plot example 3: Substrate data with vs. without an inhibitor

Next, let's make a graph of substrate concentration-time data in plasma with and without the presence of an inhibitor using midazolam example data (MDZ_Keto) that we've filtered to get only plasma data for the substrate. Let's change the figure type to show only the mean predicted concentrations. Let's include a legend, label it with something other than the default, which is "Inhibitor", and let's only make the semi-log plot here. (The filtering part isn't important here, so ignore it if it's confusing. All of these options are described in more detail in the example files in the folder "ct_plot examples".) 

```{r, fig.height = 3, fig.width = 6}

MDZ_Keto_plasma <- MDZ_Keto %>% 
    filter(CompoundID == "substrate" & Tissue == "plasma")

ct_plot(ct_dataframe = MDZ_Keto_plasma,
        time_range = "last dose", 
        figure_type = "means only", 
        linear_or_log = "log",
        legend_position = "right",
        legend_label = "Competitive inhibitor present")

```

For more options and examples, please see the subfolder "ct_plot examples" and the help file for ct_plot. Type "?ct_plot" into the console to get the help file.

# Make overlaid concentration-time plots 

You can also make concentration-time plots with multiple data sets overlaid for easy comparisons. 

## Compare substrate concentrations in multiple tissues 

We'll graph the data from the midazolam and ketoconazole simulation, coloring the lines by whether the effector was present and breaking up the graph into small multiples by the tissue and by what compound we're plotting. Let's give a sense of the variability of the data by showing transparent bands for the 5th to 95th percentiles. 

```{r}

ct_plot_overlay(ct_dataframe = MDZ_Keto,
                colorBy_column = Inhibitor,
                facet1_column = Tissue, 
                facet2_column = Compound, 
                figure_type = "percentile ribbon",
                color_set = "Set 1")

```

For more options and examples, please see the subfolder "ct_plot_overlay examples" and the help file for ct_plot_overlay. 

# Make graphs of enzyme abundance 

You can apply most of the settings from the "ct_plot" function to another function, "enz_plot", which will automatically make enzyme abundance plots for you. Just as with the ct_plot function, we're first going to extract the data using a separate function, this one called "extractEnzAbund". 

For this graph, let's include a legend and color the lines according to whether the inhibitor is present using the colors we want. We'll use example data called "CYP3A4_liver". 


```{r, fig.height=3.5, fig.width = 5}

enz_plot(CYP3A4_liver, legend_position = "right", 
         linear_or_log = "linear",
         line_type = c("solid", "solid"), 
         line_color =  c("darkturquoise", "darkblue"))

```

For more options and examples, please see the subfolder "enz_plot examples" and the help file for enz_plot.

## Overlaid enzyme-abundance graphs 

Most of the options for "ct_plot_overlay" also work for "enz_plot_overlay". Let's combine two sets of example data, CYP3A4_liver and CYP3A4_gut, and overlay them in some graphs. 

```{r}
enz_plot_overlay(sim_enz_dataframe = bind_rows(CYP3A4_gut, CYP3A4_liver),
                 colorBy_column = Tissue, facet1_column = Inhibitor, 
                 figure_type = "percentile ribbon")
```




