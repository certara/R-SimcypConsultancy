#' Concentration-time plots of the full time range, first dose, and last dose
#'
#' Conveniently group three concentration-time plots of multiple-dose data
#' together: \enumerate{\item{the full time range across the top,} \item{the
#' first dose in the lower left quadrant, and}  \item{the last dose in the lower
#' right quadrant.}} Calls on either \code{\link{ct_plot}} or
#' \code{\link{ct_plot_overlay}} to make the graphs. Requires the package
#' ggpubr. Does not work for single-dose scenarios.
#'
#' @param ct_dataframe the input concentration-time data generated by
#'   running either the function \code{\link{extractConcTime}} or the function
#'   \code{\link{extactConcTime_mult}}
#' @param overlay TRUE or FALSE for whether to make overlaid graphs, i.e.,
#'   whether to use \code{\link{ct_plot_overlay}} (TRUE) or use
#'   \code{\link{ct_plot}} (FALSE) to generate the graphs
#' @param ... arguments that pass through to \code{\link{ct_plot}} or
#'   \code{\link{ct_plot_overlay}}
#'
#' @return
#' @export
#'
#' @examples
#'
#' CT <- extractConcTime(sim_data_file = "Example simulator output.xlsx")
#' ct_plot3(ct_dataframe = CT, figure_type = "trial means",
#'          linear_or_log = "log")
#'
#' CT <- extractConcTime_mult(sim_data_files = c("Simulator output 1.xlsx",
#'                                               "Simulator output 2.xlsx",
#'                                               "Simulator output 3.xlsx"),
#'                            tissues = c("plasma", "blood"))
#' ct_plot3(ct_dataframe = CT, overlay = TRUE, colorBy_column = File,
#'          facet1_column = Tissue)
#' 

ct_plot3 <- function(ct_dataframe, 
                     overlay = FALSE, 
                     ...){
    
    if(length(sort(unique(ct_dataframe$DoseNum))) == 1){
        stop("ct_plot3 is only for multiple-dose scenarios, but these data appear to be for only one dose.")
    }
    
    if(hasArg("time_range")){
        stop("You cannot supply anything for 'time_range' here because ct_plot3 needs to set the time range automatically. Please remove 'time_range' from your arguments.")
    }
    
    if(overlay){
        
        A <- ct_plot_overlay(ct_dataframe = ct_dataframe,
                             time_range = NA,
                             ..., # comment this for development
                             include_messages = F) +
            ggtitle("Full time range")
        
        # Suppressing messages and warnings after the 1st set.
        suppressWarnings(suppressMessages(
            B <- ct_plot_overlay(ct_dataframe = ct_dataframe,
                                 time_range = "first dose",
                                 ..., # comment this for development
                                 include_messages = F) +
                ggtitle("First dose")))
        
        suppressWarnings(suppressMessages(
            C <- ct_plot_overlay(ct_dataframe = ct_dataframe,
                                 time_range = "last dose", 
                                 ..., # comment this for development
                                 include_messages = F) +
                ggtitle("Last dose")))
        
        Out <- ggpubr::ggarrange(A, ggpubr::ggarrange(B, C, legend = "none"), 
                                 nrow = 2, common.legend = TRUE, legend = "bottom")
        
    } else {
        
        if(hasArg("colorBy_column") | hasArg("facet1_column") |
           hasArg("facet2_column")){
            stop("It looks like you wanted to use 'ct_plot_overlay' with this function to create graphs of overlaid concentration-time data, but you have specified 'overlay = FALSE' (or left it as the default). Please change 'overlay' to TRUE and try again.")
        }
        
        A <- ct_plot(ct_dataframe = ct_dataframe,
                     ..., # comment this for development
                     time_range = NA) +
            ggtitle("Full time range")
        
        suppressWarnings(suppressMessages(
            B <- ct_plot(ct_dataframe = ct_dataframe,
                         ..., # comment this for development
                         time_range = "first dose") +
                ggtitle("First dose")))
        
        suppressWarnings(suppressMessages(
            C <- ct_plot(ct_dataframe = ct_dataframe,
                         ..., # comment this for development
                         time_range = "last dose") +
                ggtitle("Last dose")))
        
        Out <- ggpubr::ggarrange(A, ggpubr::ggarrange(B, C, legend = "none"), 
                                 nrow = 2, common.legend = TRUE, legend = "bottom")
    }
    
    return(Out)
    
}
